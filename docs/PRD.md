# PRD.md — Next-AI SaaS Starter（可售 MVP 版本）

## 1. 背景与问题
独立开发者与小团队在做 AI SaaS 时，最耗时且最容易踩坑的不是业务本身，而是：
- 登录/会话与受保护页面
- 订阅/权益映射（Free/Pro）
- AI 成本控制：Credits、限流、并发、滥用防护
- AI 流式体验（Streaming）与稳定性（超时/重试/错误一致性）
- i18n、SEO 基建与上线基础页面
这些能力重复开发成本高、且容易在上线后因滥用或计费不一致导致纠纷与成本失控。

## 2. 目标与非目标
### 2.1 产品目标（V1）
- 提供一个“可直接售卖”的 AI-first SaaS 启动模板：
  - 开箱跑通完整闭环（黄金路径）
  - 目录结构干净、可理解、可替换 Demo
  - 配置集中、文档傻瓜化、成本护栏默认开启

### 2.2 非目标（V1）
- 不追求企业级权限/审计/组织能力
- 不追求多业务插件系统框架化
- 不做复杂后台与报表（可列入 v2）

## 3. 目标用户与用户故事
### 3.1 目标用户
- 独立开发者：快速上线并验证收费
- 小团队：统一底座与可复制开发范式
- AI 微工具作者：需要流式体验与 Credits 成本管理

### 3.2 核心用户故事（MVP）
- 作为买家，我希望 10 分钟内跑通：注册登录 → 首页 Demo 生成 → 看到流式输出 → Credits 扣减 → 额度不足拦截提示。
- 作为买家，我希望 2 小时内替换为自己的产品：改品牌配置、替换首页 Demo、复用 AI Gateway 与 Credits。
- 作为买家，我希望默认就有成本护栏，避免上线被滥用导致账单爆炸。

## 4. 关键体验与信息架构
### 4.1 页面清单（V1）
- Home：首页即 Demo（Text-to-Emoji 或同等级别的“可玩闭环”Demo）
- Pricing：Free/Pro 差异（只写当前能力）
- Login / Signup：注册登录
- Dashboard：订阅状态、权益摘要、Credits 余额与近期扣减提示
- FAQ：常见问题
- Legal：隐私/条款合并页或分离页（按模板策略统一）
- /readme：开发者指引（默认不在导航、默认 noindex、建议默认仅开发可见或配置开启）

### 4.2 黄金路径（必须跑通）
注册/登录 → 进入 Home Demo → 输入文本 → AI 流式输出 → Credits 扣减 → 刷新余额 → Credits 不足时拦截提示 →（可选）切换到 Pro 后恢复额度/能力。

## 5. 功能需求（按模块）
### 5.1 Auth（登录与会话）
- 支持注册、登录、退出、会话恢复
- 受保护页面：未登录访问 Dashboard 自动引导登录
- 登录态下可读取用户状态（见“用户状态读取入口”）

验收：
- 新注册用户能顺利登录并看到默认 Free 状态与默认 Credits。

### 5.2 Billing & Entitlements（计费与权益）
- 方案状态最小表达：Free/Pro
- 权益映射：方案 → 权益（可用额度、并发/速率限制等级、是否开启某些能力）
- 用户状态读取入口：返回 user、plan、entitlements、credits
- 支付联动可分步：V1 可支持“模拟 Pro”开关用于演示与联调；真实支付链路可作为 V1.1 或 V1.2

验收：
- 任意页面的权益判断口径一致，不出现“页面说能用但接口拒绝/反之”的不一致。

### 5.3 Credits & Metering（用量与扣减）
- Credits 余额：支持读取与更新
- Ledger 账本：记录每次扣减/增加的原因与时间（为追溯与售后提供依据）
- 扣减通路：Demo 每次生成扣 1（或可配置）
- 最低可用性：余额不足必拦截，并提供明确提示

风险控制（必须考虑）：
- 扣减的幂等性与一致性（避免重复扣点、避免并发导致负数）
- 异常情况下的兜底（生成失败是否扣点、超时是否扣点的策略必须明确）

验收：
- 连续多次生成，余额变化符合预期；余额不足稳定拦截；账本可追溯。

### 5.4 AI Gateway（统一 AI 接口封装）
- 统一调用入口：业务页面只调用网关，不直接散落调用
- Streaming：前端可看到“逐步输出”的体验
- 错误标准化：超时/限流/余额不足等错误前端能稳定展示
- 可配置：模型/供应商参数集中配置（V1 可只支持一个供应商，但结构要便于扩展）

验收：
- Demo 能稳定流式输出；错误时提示稳定且不泄露敏感信息。

### 5.5 Abuse Protection（成本护栏）
- 匿名额度：未登录用户可体验次数/额度（可配置）
- 速率限制：最小策略（按 IP/账号维度的基本限制，策略可简化但要有效）
- 并发限制：防止同一用户/匿名并发刷接口
- 成本熔断：当检测到异常模式时具备“快速阻断”的能力或配置开关

验收：
- 以最小方式验证护栏有效（至少能触发一次限流/拦截反馈）。

### 5.6 i18n & SEO
- i18n：至少 en/zh；覆盖导航、核心按钮、错误提示
- SEO 基建：sitemap、robots、canonical、基础元信息
- /readme 页面必须默认 noindex，避免被索引

验收：
- 语言切换生效；基础 SEO 资源可生成；/readme 不被收录。

## 6. 配置化要求（商品化关键）
- 必须集中配置的项目：
  - 品牌信息：产品名、描述、联系邮箱、Logo/主题
  - AI：供应商 Key、默认模型与参数、超时/重试策略
  - Credits：默认余额、扣减规则、匿名额度
  - 限流/并发：阈值与开关
  - 计费：方案名、权益映射、（可选）演示 Pro 开关
  - /readme：是否启用、是否仅开发可见

验收：
- 买家修改配置不需要全仓库搜索替换。

## 7. 交付物（卖给用户的“产品包”）
- Starter Template 源码（干净、可运行）
- 文档：
  - Quick Start（10 分钟跑通）
  - Make it Yours（2 小时改造成自己产品）
  - Operating Guide（护栏与常见问题）
- 站内 /readme（同 Quick Start 的可视化版本）
- 回归清单（黄金路径 + 风控护栏 + i18n/SEO）

## 8. 风险与对策（V1 必须写清）
- 风险：重复扣点、并发导致余额异常
  - 对策：扣点幂等与一致性策略明确；账本可追溯
- 风险：匿名滥用导致成本爆炸
  - 对策：匿名额度 + 速率/并发限制默认开启；异常熔断开关
- 风险：订阅状态不同步导致权益错乱
  - 对策：单一“用户状态读取入口”；权益判定口径统一
- 风险：/readme 被部署公开导致泄露开发指引
  - 对策：默认 noindex + 默认不在导航 + 建议仅开发可见或配置开关

## 9. 里程碑（建议）
- M1：Auth + Schema + 用户状态读取入口跑通
- M2：Home Demo + AI Streaming + Credits 扣减跑通
- M3：限流/并发/匿名额度默认开启并可验证
- M4：i18n/SEO + /readme + 文档傻瓜化完成（达到可售）
- M5：Dogfood：用模板快速起一个极小新工具作为可信证据（可选）

## 10. Definition of Done（可售标准）
- 黄金路径闭环稳定跑通
- 配置集中、目录干净、Demo 可替换
- 成本护栏默认开启且可触发验证
- 文档（含站内 /readme）足够让陌生买家独立跑通
- 对外页面无任何内部信息泄露

## 11. 技术架构

### 11.1 技术栈
| 类别 | 技术 | 版本 |
|------|------|------|
| 框架 | Next.js | 16.x |
| 数据库 | Supabase (PostgreSQL) | - |
| 认证 | Supabase Auth | - |
| 部署 | Vercel | - |
| 包管理 | pnpm | 10.x |
| 样式 | Tailwind CSS | 4.x |
| 语言 | TypeScript | 5.x |
| 代码托管 | GitHub | - |

### 11.2 项目结构
```
saastarter/
├── src/
│   ├── app/                   # Next.js App Router
│   ├── components/            # React 组件
│   ├── lib/                   # 工具函数和配置
│   │   ├── supabase/         # Supabase 客户端
│   │   ├── auth/             # 认证工具
│   │   ├── ai/               # AI Gateway
│   │   ├── credits/          # Credits 系统
│   │   └── billing/          # 计费与权益
│   ├── types/                 # TypeScript 类型
│   └── config/                # 配置文件
├── supabase/
│   └── migrations/            # 数据库迁移
├── docs/                      # 项目文档
└── locales/                   # i18n 翻译文件
```

## 12. 补充文档

| 文档 | 路径 | 说明 |
|------|------|------|
| 环境变量 | docs/env-variables.md | 环境变量详细说明 |
| 数据库 | supabase/README.md | 数据库设计与迁移文档 |
| SSOT | docs/SSOT.md | 单一事实来源原则 |
| 发布清单 | docs/RELEASE-CHECKLIST.md | 发布验证清单 |
| 文档索引 | docs/DOCS-INDEX.md | 文档目录索引 |
